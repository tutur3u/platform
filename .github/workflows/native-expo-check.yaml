name: Native Expo Dependencies Check

on:
    push:
        branches:
            - main
        paths:
            - "apps/native/**"
            - ".github/workflows/native-expo-check.yaml"
    pull_request:
        branches:
            - main
        paths:
            - "apps/native/**"
            - ".github/workflows/native-expo-check.yaml"
    workflow_dispatch:

jobs:
    check-ci:
        uses: ./.github/workflows/ci-check.yml
        with:
            workflow_name: native-expo-check.yaml

    expo-check:
        name: Check Expo Dependencies
        needs: [check-ci]
        if: needs.check-ci.outputs.should_run == 'true'
        runs-on: ubuntu-latest
        defaults:
            run:
                working-directory: apps/native

        steps:
            - name: Check out code
              uses: actions/checkout@v6

            - name: Setup bun
              uses: oven-sh/setup-bun@v2
              with:
                  bun-version: latest

            - name: Setup Node.js
              uses: actions/setup-node@v6
              with:
                  node-version: 24

            - name: Install dependencies
              run: bun install

            - name: Check Expo dependencies alignment
              run: bunx expo install --check
