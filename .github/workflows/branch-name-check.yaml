name: Branch Name Check

on:
  push:
    branches-ignore:
      - main
      - staging
      - production

jobs:
  check-ci:
    uses: ./.github/workflows/ci-check.yml
    with:
      workflow_name: branch-name-check.yaml

  check-branch-name:
    name: Check branch name
    needs: [check-ci]
    if: needs.check-ci.outputs.should_run == 'true'
    runs-on: ubuntu-latest
    steps:
      - name: Check branch name
        run: |
          BRANCH_NAME=${GITHUB_REF#refs/heads/}
          if ! [[ $BRANCH_NAME =~ ^(feature|feat|fix|bugfix|hotfix|release|chore|docs|style|refactor|perf|dependabot|claude)/.+ ]]; then
            echo "❌ Branch name '$BRANCH_NAME' doesn't follow the conventional branch format."
            echo "Branch name should be in format: type/description"
            echo "Allowed types: feature, feat, fix, bugfix, hotfix, release, chore, docs, style, refactor, perf, dependabot, claude"
            exit 1
          else
            echo "✅ Branch name follows convention: $BRANCH_NAME"
          fi
